import datetime
import unittest
from poker_game.play_game import play_game
from poker_game.utils.players import Player, ActualPlayerTemplate, create_player
from poker_game.utils.table import Table
from poker_game.utils.objects_on_table import Deck, Chips, Card
from poker_game.utils.game import TexasHoldemGame
from poker_game.utils.logging_config import setup_logging
import logging
from collections import Counter
import random

setup_logging()
logger = logging.getLogger('poker_game')

class TestTexasHoldemGame(unittest.TestCase):
    def test_random_players_random_games(self):
        # test how long this test takes
        start = datetime.datetime.now()
        winnerlist = []
        role_list = ['raises with aces reduces with 12345', 'conservative', 'careful calculator', 'aggressive', 'always fold', 'super aggressive']
        for game in range(1, 10000): 
            # get the game number
            logger.info(f"Game NR {game}")

            #check if a game is looping forever
            date = datetime.datetime.now()
            
            table = Table()
            A = create_player("A", role_list[random.randint(0,5)], Chips(100))
            B = create_player("B", role_list[random.randint(0,5)], Chips(100))
            C = create_player("C", role_list[random.randint(0,5)], Chips(100))
            D = create_player("D", role_list[random.randint(0,5)], Chips(100))
            E = create_player("E", role_list[random.randint(0,5)], Chips(100))
            F = create_player("F", role_list[random.randint(0,5)], Chips(100))
            
            table.add_player(A)
            table.add_player(B)
            table.add_player(C)
            table.add_player(D)
            table.add_player(E)
            table.add_player(F)
            
            expected_sum = sum([player.chips.amount for player in table.players])

            winner, rounds = play_game(table=table)
            winnerlist.append(winner)
            logger.info(f"Winner of game {game} is {winner} after {rounds} rounds!")
        logger.info(f"Winnerlist: {Counter(winnerlist)}")
        end = datetime.datetime.now()
        logger.info(f"Time taken: {end-start}")
        # self.assertEqual(sum([player.chips.amount for player in result_table.players]), expected_sum)


if __name__ == '__main__': 
    unittest.main()